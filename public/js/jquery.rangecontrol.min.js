(function(){var d,b,a={}.hasOwnProperty,c=function(h,f){for(var e in f){if(a.call(f,e)){h[e]=f[e]}}function g(){this.constructor=h}g.prototype=f.prototype;h.prototype=new g();h.__super__=f.prototype;return h};d=(function(){e._min;e._max;e._leftControlValue;e._rightControlValue;e._step;e._dragged;e._renderControlCallback;e._width;e._widthWithoutPaddings;e._controlWidth;e._pxInValue;e._rangeElement;e._changeTimeout;e.prototype.PLUGINNAME="range-control";e.prototype.DRAGCLASSNAME="is-dragged";e.prototype.keyCode={LEFT:37,RIGHT:39};e.prototype.defaultOptions={keyLeft:e.prototype.keyCode.LEFT,keyRight:e.prototype.keyCode.RIGHT,min:0,max:100,step:1,timeout:500,formatControlCallback:function(f){return f}};function e(g,f){this.el=g;this.options=f;this.settings=$.extend({},this.defaultOptions,f);this.el.data(this.PLUGINNAME,this);this._formatControlCallback=this.settings.formatControlCallback;this._renderRangeControl();this.min(this.el.data("min")||this.settings.min);this.max(this.el.data("max")||this.settings.max);this.step(this.el.data("step")||this.settings.step);this._initDimensions();this.leftValue(this.el.data("left-value")||this.settings.leftValue||this._min);this.rightValue(this.el.data("right-value")||this.settings.rightValue||this._max);this._initControls();this._bindResize()}e.prototype.min=function(f){if(f!=null){return this._min=parseInt(f)}else{return this._min}};e.prototype.max=function(f){if(f!=null){return this._max=parseInt(f)}else{return this._max}};e.prototype.step=function(f){if(f){return this._step=parseInt(f)}else{return this._step}};e.prototype.value=function(){return{leftValue:this._getLeftValue(),rightValue:this._getRightValue()}};e.prototype.leftValue=function(f){if(f!=null){this._leftControlValue=this._validateLeftValue(f);this._renderLeftControl(this._leftControlValue);this._formatLeftControl();return this._renderRange()}else{return this._getLeftValue()}};e.prototype.rightValue=function(f){if(f!=null){this._rightControlValue=this._validateRightValue(f);this._renderRightControl(this._rightControlValue);this._formatRightControl();return this._renderRange()}else{return this._getRightValue()}};e.prototype._getLeftValue=function(){if(this._valueStep===1){return this._leftControlValue}else{return this._min+((this._leftControlValue-this._min)-(this._leftControlValue-this._min)%this._step)}};e.prototype._getRightValue=function(){if(this._valueStep===1){return this._rightControlValue}else{return this._min+((this._rightControlValue-this._min)-(this._rightControlValue-this._min)%this._step)}};e.prototype._getValueByPosition=function(f){return this._min+Math.round(f/this._pxInValue)};e.prototype._valueByControl=function(g,f){if(g!=null){if(g[0]===this._leftControl[0]){if(f!=null){return this.leftValue(f)}else{return this._leftControlValue}}else{if(g[0]===this._rightControl[0]){if(f!=null){return this.rightValue(f)}else{return this._rightControlValue}}}}};e.prototype._getPositionByValue=function(f){return f*this._pxInValue};e.prototype._getPositionWithControlByValue=function(f){return this._getPositionByValue(f)+this._controlWidth};e.prototype._bindControlKeys=function(){var j,h,i,g,f,k=this;h=[this._leftControl,this._rightControl];f=[];for(i=0,g=h.length;i<g;i++){j=h[i];f.push(j.on("keydown",function(l){j=$(l.currentTarget);if(l.keyCode===k.settings.keyLeft){return k._valueByControl(j,k._valueByControl(j)-1)}else{if(l.keyCode===k.settings.keyRight){return k._valueByControl(j,k._valueByControl(j)+1)}}}))}return f};e.prototype._bindResize=function(){var f=this;return $(window).on("resize",function(){return f.render()})};e.prototype._initDimensions=function(){this._controlWidth=this._leftControl.outerWidth();this._width=this.el.outerWidth();this._widthWithoutPaddings=this.el.width();return this._pxInValue=this._widthWithoutPaddings/(this._max-this._min)};e.prototype._initControls=function(){var i,g,h,f,j=this;g=[this._leftControl,this._rightControl];for(h=0,f=g.length;h<f;h++){i=g[h];i.on("dragstart",function(){return false});i.on("mouseup",function(){j.dragged=false;i.removeClass(j.DRAGCLASSNAME);return $(document).off("mousemove")})}this._leftControl.on("mousedown",function(n){var l,m,o,k;if(n.which!==1){return}j._leftControl.addClass(j.DRAGCLASSNAME);j._dragged=true;k=j.el.offset().left;o=n.clientX-j._leftControl.offset().left;l=0;m=j._rightControl.offset().left-k;return $(document).on("mousemove",function(p){return j._controlMoveTo(j._leftControl,p.clientX,k,o,l,m)})});this._rightControl.on("mousedown",function(n){var l,m,o,k;if(n.which!==1){return}j._rightControl.addClass(j.DRAGCLASSNAME);j._dragged=true;k=j.el.offset().left;o=n.clientX-j._rightControl.offset().left;l=j._leftControl.offset().left-k+j._controlWidth;m=j._width;return $(document).on("mousemove",function(p){return j._controlMoveTo(j._rightControl,p.clientX,k,o,l,m)})});this._leftControl.on("click",function(){return false});this._rightControl.on("click",function(){return false});$(document).on("mouseup",function(){j._leftControl.triggerHandler("mouseup");return j._rightControl.triggerHandler("mouseup")});this._renderLeftControl(this._leftControlValue);this._renderRightControl(this._rightControlValue);return this._bindControlKeys()};e.prototype._controlMoveTo=function(h,f,g,j,i,l){var k,m,n;m=f-g-j;n=f-g-j+this._controlWidth;if(m>=i&&n<l){k=m}if(m<i){k=i}if(n>l){k=l-this._controlWidth}if(h===this._leftControl){this.leftValue(this._getValueByPosition(k))}if(h===this._rightControl){this.rightValue(this._getValueByPosition(k-this._controlWidth))}return this._fireChangeEvent()};e.prototype._renderRangeControl=function(){var f;this.el.addClass(this.PLUGINNAME);this.el.children().remove();this._leftControl=$("<button class='"+this.PLUGINNAME+"__left'></button>");this._rightControl=$("<button class='"+this.PLUGINNAME+"__right'></button>");this._rangeElement=$("<div class='"+this.PLUGINNAME+"__range is-active'></div>");f=$("<div class='"+this.PLUGINNAME+"__range'></div>");return this.el.append(this._leftControl).append(this._rightControl).append(f).append(this._rangeElement)};e.prototype._renderRange=function(){var f,g;f=((this._leftControlValue-this._min)*this._pxInValue)+this._controlWidth-(this._controlWidth/2);g=((this._rightControlValue-this._min)*this._pxInValue)+this._controlWidth+(this._controlWidth/2);return this._rangeElement.css({left:f,right:this._width-g})};e.prototype._renderLeftControl=function(g){var f;f=(g-this._min)*this._pxInValue;return this._leftControl.css({left:f})};e.prototype._renderRightControl=function(g){var f;f=this._controlWidth+((g-this._min)*this._pxInValue);return this._rightControl.css({left:f})};e.prototype._validateLeftValue=function(f){if(f<=this._min){return this._min}else{if(f>=this._rightControlValue){return this._rightControlValue}else{return f}}};e.prototype._validateRightValue=function(f){if(f>=this._max){return this._max}else{if(f<=this._leftControlValue){return this._leftControlValue}else{return f}}};e.prototype._formatLeftControl=function(){if(this._formatControlCallback!=null){return this._leftControl.html(this._formatControlCallback(this.leftValue()))}};e.prototype._formatRightControl=function(){if(this._formatControlCallback!=null){return this._rightControl.html(this._formatControlCallback(this.rightValue()))}};e.prototype._formatValue=function(f){return f};e.prototype._fireChangeEvent=function(){var f=this;clearTimeout(this._changeTimeout);return this._changeTimeout=setTimeout(function(){return f.el.trigger("change",f.value())},this.settings.timeout)};e.prototype.render=function(){this._initDimensions();this.leftValue(this._leftControlValue);return this.rightValue(this._rightControlValue)};e.prototype.rebuild=function(f){if(f==null){f=this.options}return this.constructor(this.el,f)};e.prototype.destroy=function(){this.el.html("");return this.el.removeData(this.PLUGINNAME)};return e})();b=(function(f){c(e,f);e.prototype.PLUGINNAME="range-control-graph";e.prototype.defaultOptions={keyLeft:e.prototype.keyCode.LEFT,keyRight:e.prototype.keyCode.RIGHT,min:0,max:100,step:1,timeout:500,formatControlCallback:function(g){return g},colorsRange:{"#e6ead4":[0,100],"#ced7a6":[101,1000],"#b4c373":[1001,10000],"#fed46d":[10001]},colorCell:"#288bf0"};function e(h,g){this.el=h;this.options=g;this.settings=$.extend({},this.defaultOptions,g);this._renderRangeControl();this._initDimensions();this._renderRange();this.min(0);this.max(Object.keys(this.options.data).length);this.leftValue(this.min());this.rightValue(this.max());e.__super__.constructor.call(this,this.el,$.extend(this.settings,{min:this.min(),max:this.max()}))}e.prototype._renderRangeControl=function(){this.el.addClass(this.PLUGINNAME);this.el.children().remove();this._leftControl=$("<button class='"+this.PLUGINNAME+"__left'></button>").appendTo(this.el);this._rightControl=$("<button class='"+this.PLUGINNAME+"__right'></button>").appendTo(this.el);this._rangeElement=$("<canvas class='"+this.PLUGINNAME+"__range'></canvas>").appendTo(this.el);this._rangeElementHover=$("<canvas class='"+this.PLUGINNAME+"__range-hover'></canvas>").appendTo(this.el);this._rangeGreyWrapLeft=$("<div class='"+this.PLUGINNAME+"__wrap-range-grey-left'></div>");this._rangeGreyElementLeft=$("<canvas class='"+this.PLUGINNAME+"__range-grey'></canvas>").appendTo(this._rangeGreyWrapLeft);this._rangeGreyWrapRight=$("<div class='"+this.PLUGINNAME+"__wrap-range-grey-right'></div>");this._rangeGreyElementRight=$("<canvas class='"+this.PLUGINNAME+"__range-grey'></canvas>").appendTo(this._rangeGreyWrapRight);this._hoverElement=$("<div class='"+this.PLUGINNAME+"__hover'>111</div>").appendTo(this.el);this._rangeGreyWrapLeft.appendTo(this.el);return this._rangeGreyWrapRight.appendTo(this.el)};e.prototype._renderRange=function(){var g,j,i,h;j=(function(){var l,k;l=this.options.data;k=[];for(i in l){h=l[i];k.push(h)}return k}).call(this);this._maxRangeVolume=Math.max.apply(null,j);g=Object.keys(this.options.data).length;this.canvas=this._rangeElement[0].getContext("2d");this.canvasScale=30;this.canvasHeight=this.el.height();this.canvasWidth=g*this.canvasScale;this._rangeElement[0].width=g*this.canvasScale;this._rangeElement[0].height=this.el.height();this._rangeElement.width(this._widthWithoutPaddings);this._renderColorRange();this._renderRangeCells();this._renderGreyRange();this._renderRangeWraps();return this._renderRangeHover()};e.prototype._renderColorRange=function(){var h,n,m,j,o,g,l,k;if(this.dataColorRange==null){this.dataColorRange={};n=this.settings.colorsRange;m=this.settings.data;for(h in n){g=n[h];this.dataColorRange[h]=[];j=-1;for(k in m){j++;o=g[0];l=g[1]!=null?g[1]:Infinity;if((o<=k&&k<=l)){this.dataColorRange[h].push(j);continue}else{if(k>l){break}}}}}return this._drawColorRange()};e.prototype._drawColorRange=function(){var i,k,j,h,m,l,g;l=this.dataColorRange;g=[];for(i in l){h=l[i];k=Math.min.apply(null,h);m=Math.max.apply(null,h);j=h.length;this.canvas.fillStyle=i;g.push(this.canvas.fillRect(k*this.canvasScale,0,j*this.canvasScale,this.canvasHeight))}return g};e.prototype._renderRangeCells=function(){var h,l,j,k,g;h=0;this.canvas.fillStyle=this.settings.colorCell;k=this.options.data;g=[];for(l in k){j=k[l];g.push(this._renderRangeCell(h++,j))}return g};e.prototype._renderRangeCell=function(h,j){var g;g=this.canvasHeight/this._maxRangeVolume*j;return this.canvas.fillRect(this.canvasScale*h,this.canvasHeight,this.canvasScale,-g)};e.prototype._renderGreyRange=function(){var l,k,g,m,j,h;this.greyCanvasLeft=this._rangeGreyElementLeft[0].getContext("2d");this._rangeGreyElementLeft[0].width=this._rangeElement[0].width;this._rangeGreyElementLeft[0].height=this._rangeElement[0].height;this._rangeGreyElementLeft.width(this._widthWithoutPaddings);this.greyCanvasRight=this._rangeGreyElementRight[0].getContext("2d");this._rangeGreyElementRight[0].width=this._rangeElement[0].width;this._rangeGreyElementRight[0].height=this._rangeElement[0].height;this._rangeGreyElementRight.width(this._widthWithoutPaddings);m=this.canvas.getImageData(0,0,this._rangeElement[0].width,this._rangeElement[0].height);k=m.data;for(g=j=0,h=k.length-1;j<=h;g=j+=4){l=0.34*k[g]+0.5*k[g+1]+0.16*k[g+2];k[g]=l;k[g+1]=l;k[g+2]=l}this.greyCanvasLeft.putImageData(m,0,0);return this.greyCanvasRight.putImageData(m,0,0)};e.prototype._renderRangeWraps=function(){var g,h;g=((this._leftControlValue-this._min)*this._pxInValue)+this._controlWidth-(this._controlWidth/2);h=this._width-((this._rightControlValue-this._min)*this._pxInValue+this._controlWidth+(this._controlWidth/2));this._rangeGreyWrapLeft.css({width:g});return this._rangeGreyWrapRight.css({width:h})};e.prototype._renderRangeHover=function(){var g=this;this.canvasHover=this._rangeElementHover[0].getContext("2d");this._rangeElementHover[0].width=this._rangeElement[0].width;this._rangeElementHover[0].height=this._rangeElement[0].height;this._rangeElementHover.width(this._widthWithoutPaddings);this._rangeElementHover.on("mousemove",function(j){var i,h;h=j.offsetX;i=g._getValueByPosition(h);g._drawRangeHover(i);g._hoverElement.show().css({left:g._getPositionWithControlByValue(i)});return g._hoverElement.text(g._getVolumeByIndexNumber(i))});return this._rangeElementHover.on("mouseout",function(h){g._clearRangeHover();return g._hoverElement.hide()})};e.prototype._drawRangeHover=function(g){this._clearRangeHover();return this._renderRangeCell(g,this.getVolumeByValue(g))};e.prototype._clearRangeHover=function(){return this.canvasHover.clearRect(0,0,this._rangeElement[0].width,this._rangeElement[0].height)};e.prototype._formatLeftControl=function(){var g;g=this._getLeftValue();if(this._formatControlCallback!=null){return this._leftControl.html(this._formatControlCallback(g))}};e.prototype._formatRightControl=function(){var g;g=this._getRightValue();if(this._formatControlCallback!=null){return this._rightControl.html(this._formatControlCallback(g))}};e.prototype._getLeftValue=function(){return this._getValueByIndexNumber(this._leftControlValue)};e.prototype._getRightValue=function(){return this._getValueByIndexNumber(this._rightControlValue)};e.prototype._getValueByIndexNumber=function(g){var h;h=Object.keys(this.options.data)[g-1];if(h==null){h=0}return parseInt(h)};e.prototype.getVolumeByValue=function(g){return this.options.data[g]};e.prototype._getVolumeByIndexNumber=function(g){return this.getVolumeByValue(this._getValueByIndexNumber(g))};e.prototype.testCanvasSupport=function(){return !!document.createElement("canvas").getContext};return e})(d);$.fn.rangeControl=function(e){var f;f=d.prototype.PLUGINNAME;return this.each(function(){if($(this).data(f)===void 0){return new d($(this),e)}else{return $(this).data(f)}})};$.fn.rangeControlGraph=function(e){var f;f=b.prototype.PLUGINNAME;return this.each(function(){if($(this).data(f)===void 0){return new b($(this),e)}else{return $(this).data(f)}})}}).call(this);